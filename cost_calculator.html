<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Cost Calculator - Enhanced Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .calculator-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1B5E20, #2E7D32);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1rem;
        }

        .content {
            padding: 30px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            margin-bottom: 20px;
        }

        .section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .section h3 {
            color: #1B5E20;
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 18px;
        }

        .form-group label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #1B5E20;
            box-shadow: 0 0 0 3px rgba(27, 94, 32, 0.1);
        }

        .input-group {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 12px;
        }

        .btn {
            background: linear-gradient(135deg, #1B5E20, #2E7D32);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin: 3px;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(27, 94, 32, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f44336, #ff6b6b);
        }

        .btn-success {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
        }

        .btn-primary {
            background: linear-gradient(135deg, #2196F3, #42A5F5);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .data-table th {
            background: #1B5E20;
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .data-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.85rem;
        }

        .data-table tr:hover {
            background: #f8f9fa;
            cursor: pointer;
        }

        .data-table tr.selected {
            background: #e8f5e8;
        }

        .cost-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, #e8f5e8, #f1f8f1);
            border-radius: 10px;
        }

        .summary-item {
            text-align: center;
        }

        .summary-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #1B5E20;
            margin-bottom: 5px;
        }

        .summary-label {
            font-size: 0.85rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-display {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
            font-weight: 600;
            color: #1B5E20;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 12px 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 0.85rem;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            color: #2196F3;
            margin-left: 5px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 10px 0;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <div class="header">
            <h1>🧮 Professional Cost Calculator - Enhanced Edition</h1>
            <p>Industry-Standard COGS (Cost of Goods Sold) Calculation with Advanced Features | Based on Cosmetic Manufacturing Research</p>
        </div>

        <div class="content">
            <div class="grid">
                <!-- Raw Materials Section -->
                <div class="section">
                    <h3>🧪 Raw Materials & Ingredients</h3>
                    
                    <div class="info-box">
                        <strong>COGS (Cost of Goods Sold):</strong> Total direct costs to produce your product<br>
                        <strong>Industry Standard:</strong> Raw materials typically represent 25-50% of selling price (average 35%)
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="apply-waste-factor">
                        <label for="apply-waste-factor">Apply waste factor (5-10% typical)</label>
                    </div>

                    <div class="form-group">
                        <label>Waste Factor % (if enabled)</label>
                        <input type="number" id="waste-factor" class="form-control" value="7" min="0" max="50" step="0.1">
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="apply-yield-factor">
                        <label for="apply-yield-factor">Apply yield factor</label>
                    </div>

                    <div class="form-group">
                        <label>Expected Yield % (if enabled)</label>
                        <input type="number" id="yield-percentage" class="form-control" value="95" min="1" max="100" step="0.1">
                    </div>

                    <div class="input-group">
                        <input type="text" id="material-name" class="form-control" placeholder="Material Name">
                        <input type="number" id="material-quantity" class="form-control" step="0.001" min="0" placeholder="Quantity">
                        <select id="material-unit" class="form-control">
                            <option value="g">g</option>
                            <option value="kg">kg</option>
                            <option value="ml">ml</option>
                            <option value="l">l</option>
                            <option value="units">units</option>
                        </select>
                        <input type="number" id="material-cost" class="form-control" step="0.001" min="0" placeholder="$ per unit">
                    </div>
                    <button class="btn btn-success" onclick="addMaterial()">+ Add Material</button>
                    <button class="btn btn-danger" onclick="removeSelectedMaterial()">- Remove Selected</button>

                    <table class="data-table" id="materials-table">
                        <thead>
                            <tr>
                                <th>Material Name</th>
                                <th>Quantity</th>
                                <th>Unit Cost</th>
                                <th>Total Cost</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>

                    <button class="btn btn-primary" onclick="calculateMaterialCosts()">Calculate Material Costs</button>
                    <div id="materials-result" class="result-display"></div>
                </div>

                <!-- Packaging Section -->
                <div class="section">
                    <h3>📦 Packaging</h3>
                    
                    <div class="info-box">
                        <strong>Industry Standard:</strong> Packaging represents 10-20% of final product cost
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="moq-enabled">
                        <label for="moq-enabled">Enable MOQ (Minimum Order Quantity) calculation</label>
                    </div>

                    <div class="form-group">
                        <label>MOQ Quantity (if enabled)</label>
                        <input type="number" id="moq-quantity" class="form-control" value="5000" min="1">
                    </div>

                    <div class="form-group">
                        <label>MOQ Setup Cost $ (if enabled)</label>
                        <input type="number" id="moq-setup-cost" class="form-control" value="500" min="0" step="0.01">
                    </div>

                    <div class="input-group">
                        <input type="text" id="packaging-name" class="form-control" placeholder="Packaging Item">
                        <input type="number" id="packaging-quantity" class="form-control" step="0.001" min="0" placeholder="Quantity">
                        <select id="packaging-unit" class="form-control">
                            <option value="units">units</option>
                            <option value="g">g</option>
                            <option value="kg">kg</option>
                            <option value="ml">ml</option>
                            <option value="l">l</option>
                        </select>
                        <input type="number" id="packaging-cost" class="form-control" step="0.001" min="0" placeholder="$ per unit">
                    </div>
                    <button class="btn btn-success" onclick="addPackaging()">+ Add Packaging</button>
                    <button class="btn btn-danger" onclick="removeSelectedPackaging()">- Remove Selected</button>

                    <table class="data-table" id="packaging-table">
                        <thead>
                            <tr>
                                <th>Packaging Item</th>
                                <th>Quantity</th>
                                <th>Unit Cost</th>
                                <th>Total Cost</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>

                    <button class="btn btn-primary" onclick="calculatePackagingCosts()">Calculate Packaging Costs</button>
                    <div id="packaging-result" class="result-display"></div>
                </div>

                <!-- Manufacturing Costs -->
                <div class="section">
                    <h3>🏭 Manufacturing & Labor</h3>
                    
                    <div class="info-box">
                        <strong>Industry Standard:</strong> Labor burden rate is 25-35% above base wages
                    </div>

                    <div class="form-group">
                        <label>Batch Size (units)</label>
                        <input type="number" id="batch-size" class="form-control" value="1000" min="1">
                    </div>

                    <div class="form-group">
                        <label>Base Labor Cost per Batch ($)</label>
                        <input type="number" id="labor-cost" class="form-control" step="0.01" min="0" value="50">
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="apply-labor-burden" checked>
                        <label for="apply-labor-burden">Apply labor burden rate</label>
                    </div>

                    <div class="form-group">
                        <label>Labor Burden Rate % (benefits, taxes, etc.)</label>
                        <input type="number" id="labor-burden-rate" class="form-control" value="30" min="0" max="100" step="1">
                    </div>

                    <div class="form-group">
                        <label>Equipment/Utilities per Batch ($)</label>
                        <input type="number" id="equipment-cost" class="form-control" step="0.01" min="0" value="25">
                    </div>

                    <div class="form-group">
                        <label>Setup Time Cost ($)</label>
                        <input type="number" id="setup-cost" class="form-control" step="0.01" min="0" value="30">
                    </div>

                    <button class="btn btn-primary" onclick="calculateManufacturingCosts()">Calculate Manufacturing</button>
                    <div id="manufacturing-result" class="result-display"></div>
                </div>

                <!-- Quality Control & Compliance -->
                <div class="section">
                    <h3>✅ Quality Control & Compliance</h3>
                    
                    <div class="info-box">
                        <strong>Industry Standard:</strong> QC costs represent 5-15% of total manufacturing costs
                    </div>

                    <div class="form-group">
                        <label>Quality Testing per Batch ($)</label>
                        <input type="number" id="qc-cost" class="form-control" step="0.01" min="0" value="75">
                    </div>

                    <div class="form-group">
                        <label>Regulatory Compliance per Batch ($)</label>
                        <input type="number" id="compliance-cost" class="form-control" step="0.01" min="0" value="50">
                    </div>

                    <div class="form-group">
                        <label>Documentation & Record Keeping ($)</label>
                        <input type="number" id="documentation-cost" class="form-control" step="0.01" min="0" value="25">
                    </div>

                    <button class="btn btn-primary" onclick="calculateQualityCosts()">Calculate Quality Costs</button>
                    <div id="quality-result" class="result-display"></div>
                </div>

                <!-- Overhead Allocation -->
                <div class="section">
                    <h3>📊 Overhead & Indirect Costs</h3>
                    
                    <div class="info-box">
                        <strong>Industry Standard:</strong> Overhead typically 15-25% of direct costs
                    </div>

                    <div class="form-group">
                        <label>Overhead Allocation Method</label>
                        <select id="overhead-method" class="form-control">
                            <option value="percentage">Percentage of Direct Costs</option>
                            <option value="per-unit">Fixed Amount per Unit</option>
                            <option value="per-batch">Fixed Amount per Batch</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Overhead Value</label>
                        <input type="number" id="overhead-value" class="form-control" step="0.01" min="0" value="20">
                    </div>

                    <div class="form-group">
                        <label>Storage/Warehousing per Unit ($)</label>
                        <input type="number" id="storage-cost" class="form-control" step="0.001" min="0" value="0.15">
                    </div>

                    <button class="btn btn-primary" onclick="calculateOverheadCosts()">Calculate Overhead</button>
                    <div id="overhead-result" class="result-display"></div>
                </div>

                <!-- Profit Analysis -->
                <div class="section">
                    <h3>💰 Profit Analysis</h3>
                    
                    <div class="info-box">
                        <strong>Target Margins:</strong> Mass market 50-60%, Premium 70-80%, Luxury 80-90%
                    </div>

                    <div class="form-group">
                        <label>Target Retail Price ($)</label>
                        <input type="number" id="retail-price" class="form-control" step="0.01" min="0">
                    </div>

                    <div class="form-group">
                        <label>Retailer Margin (%)</label>
                        <input type="number" id="retailer-margin" class="form-control" step="1" min="0" max="100" value="50">
                    </div>

                    <div class="form-group">
                        <label>Distributor Margin (%)</label>
                        <input type="number" id="distributor-margin" class="form-control" step="1" min="0" max="100" value="25">
                    </div>

                    <button class="btn btn-primary" onclick="calculateProfitability()">Calculate Profitability</button>
                    <div id="profit-result" class="result-display"></div>
                </div>
            </div>

            <!-- Total Cost Summary -->
            <div class="section" style="grid-column: 1 / -1;">
                <h3>📊 Total Cost Summary</h3>
                
                <div class="info-box">
                    <strong>COGS (Cost of Goods Sold):</strong> The direct costs attributable to production, including raw materials, packaging, labor, manufacturing overhead, quality control, and all other costs directly involved in creating the product.
                </div>

                <div class="cost-summary" id="cost-summary">
                    <div class="summary-item">
                        <div class="summary-value" id="total-cogs">$0.00</div>
                        <div class="summary-label">Total COGS per Unit</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value" id="gross-margin">0%</div>
                        <div class="summary-label">Gross Margin</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value" id="net-profit">$0.00</div>
                        <div class="summary-label">Net Profit per Unit</div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-success" onclick="calculateAllCosts()">📊 Calculate All Costs</button>
                    <button class="btn btn-primary" onclick="generateReport()">📄 Generate Report</button>
                    <button class="btn" onclick="resetCalculator()">🔄 Reset Calculator</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application State
        let materials = [];
        let packaging = [];
        let selectedMaterialIndex = -1;
        let selectedPackagingIndex = -1;
        let costAnalysis = {
            materialsCost: 0,
            packagingCost: 0,
            manufacturingCost: 0,
            qualityCost: 0,
            overheadCost: 0,
            totalCOGS: 0,
            profitAnalysis: null
        };

        // Material Functions
        function addMaterial() {
            const name = document.getElementById('material-name').value.trim();
            const quantity = parseFloat(document.getElementById('material-quantity').value);
            const unit = document.getElementById('material-unit').value;
            const cost = parseFloat(document.getElementById('material-cost').value);

            if (!name || !quantity || !cost) {
                alert('Please fill in all material fields');
                return;
            }

            let adjustedCost = cost;
            
            // Apply waste factor if enabled
            if (document.getElementById('apply-waste-factor').checked) {
                const wasteFactor = parseFloat(document.getElementById('waste-factor').value) / 100;
                adjustedCost = cost * (1 + wasteFactor);
            }

            // Apply yield factor if enabled
            if (document.getElementById('apply-yield-factor').checked) {
                const yieldPercentage = parseFloat(document.getElementById('yield-percentage').value) / 100;
                adjustedCost = adjustedCost / yieldPercentage;
            }

            const totalCost = quantity * adjustedCost;

            materials.push({
                name,
                quantity,
                unit,
                unitCost: adjustedCost,
                totalCost
            });

            updateMaterialsTable();
            clearMaterialInputs();
        }

        function removeSelectedMaterial() {
            if (selectedMaterialIndex >= 0) {
                materials.splice(selectedMaterialIndex, 1);
                selectedMaterialIndex = -1;
                updateMaterialsTable();
            }
        }

        function updateMaterialsTable() {
            const tbody = document.querySelector('#materials-table tbody');
            tbody.innerHTML = '';

            materials.forEach((material, index) => {
                const row = tbody.insertRow();
                row.onclick = () => selectMaterialRow(index);
                if (index === selectedMaterialIndex) row.classList.add('selected');

                row.innerHTML = `
                    <td>${material.name}</td>
                    <td>${material.quantity} ${material.unit}</td>
                    <td>$${material.unitCost.toFixed(4)}</td>
                    <td>$${material.totalCost.toFixed(2)}</td>
                `;
            });
        }

        function selectMaterialRow(index) {
            selectedMaterialIndex = index;
            updateMaterialsTable();
        }

        function clearMaterialInputs() {
            document.getElementById('material-name').value = '';
            document.getElementById('material-quantity').value = '';
            document.getElementById('material-cost').value = '';
        }

        // Packaging Functions
        function addPackaging() {
            const name = document.getElementById('packaging-name').value.trim();
            const quantity = parseFloat(document.getElementById('packaging-quantity').value);
            const unit = document.getElementById('packaging-unit').value;
            let cost = parseFloat(document.getElementById('packaging-cost').value);

            if (!name || !quantity || !cost) {
                alert('Please fill in all packaging fields');
                return;
            }

            // Apply MOQ calculation if enabled
            if (document.getElementById('moq-enabled').checked) {
                const moqQuantity = parseFloat(document.getElementById('moq-quantity').value);
                const setupCost = parseFloat(document.getElementById('moq-setup-cost').value);
                cost = (setupCost + (cost * moqQuantity)) / moqQuantity;
            }

            const totalCost = quantity * cost;

            packaging.push({
                name,
                quantity,
                unit,
                unitCost: cost,
                totalCost
            });

            updatePackagingTable();
            clearPackagingInputs();
        }

        function removeSelectedPackaging() {
            if (selectedPackagingIndex >= 0) {
                packaging.splice(selectedPackagingIndex, 1);
                selectedPackagingIndex = -1;
                updatePackagingTable();
            }
        }

        function updatePackagingTable() {
            const tbody = document.querySelector('#packaging-table tbody');
            tbody.innerHTML = '';

            packaging.forEach((item, index) => {
                const row = tbody.insertRow();
                row.onclick = () => selectPackagingRow(index);
                if (index === selectedPackagingIndex) row.classList.add('selected');

                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.quantity} ${item.unit}</td>
                    <td>$${item.unitCost.toFixed(4)}</td>
                    <td>$${item.totalCost.toFixed(2)}</td>
                `;
            });
        }

        function selectPackagingRow(index) {
            selectedPackagingIndex = index;
            updatePackagingTable();
        }

        function clearPackagingInputs() {
            document.getElementById('packaging-name').value = '';
            document.getElementById('packaging-quantity').value = '';
            document.getElementById('packaging-cost').value = '';
        }

        // Calculation Functions
        function calculateMaterialCosts() {
            if (materials.length === 0) {
                alert('Please add materials first');
                return;
            }

            costAnalysis.materialsCost = materials.reduce((sum, m) => sum + m.totalCost, 0);
            
            const resultDiv = document.getElementById('materials-result');
            resultDiv.textContent = `Total Materials Cost: $${costAnalysis.materialsCost.toFixed(2)}`;
            resultDiv.style.display = 'block';
            
            updateCostSummary();
        }

        function calculatePackagingCosts() {
            if (packaging.length === 0) {
                alert('Please add packaging items first');
                return;
            }

            costAnalysis.packagingCost = packaging.reduce((sum, p) => sum + p.totalCost, 0);
            
            const resultDiv = document.getElementById('packaging-result');
            resultDiv.textContent = `Total Packaging Cost: $${costAnalysis.packagingCost.toFixed(2)}`;
            resultDiv.style.display = 'block';
            
            updateCostSummary();
        }

        function calculateManufacturingCosts() {
            const batchSize = parseFloat(document.getElementById('batch-size').value);
            let laborCost = parseFloat(document.getElementById('labor-cost').value);
            const equipmentCost = parseFloat(document.getElementById('equipment-cost').value);
            const setupCost = parseFloat(document.getElementById('setup-cost').value);

            // Apply labor burden if enabled
            if (document.getElementById('apply-labor-burden').checked) {
                const burdenRate = parseFloat(document.getElementById('labor-burden-rate').value) / 100;
                laborCost = laborCost * (1 + burdenRate);
            }

            const totalBatchCost = laborCost + equipmentCost + setupCost;
            const perUnitCost = totalBatchCost / batchSize;

            costAnalysis.manufacturingCost = perUnitCost;
            
            const resultDiv = document.getElementById('manufacturing-result');
            resultDiv.innerHTML = `Manufacturing Cost per Unit: $${perUnitCost.toFixed(3)}<br>Total Batch Cost: $${totalBatchCost.toFixed(2)}`;
            resultDiv.style.display = 'block';
            
            updateCostSummary();
        }

        function calculateQualityCosts() {
            const batchSize = parseFloat(document.getElementById('batch-size').value);
            const qcCost = parseFloat(document.getElementById('qc-cost').value);
            const complianceCost = parseFloat(document.getElementById('compliance-cost').value);
            const documentationCost = parseFloat(document.getElementById('documentation-cost').value);

            const totalQualityCost = qcCost + complianceCost + documentationCost;
            const perUnitCost = totalQualityCost / batchSize;

            costAnalysis.qualityCost = perUnitCost;
            
            const resultDiv = document.getElementById('quality-result');
            resultDiv.innerHTML = `Quality Cost per Unit: $${perUnitCost.toFixed(3)}<br>Total Quality Cost per Batch: $${totalQualityCost.toFixed(2)}`;
            resultDiv.style.display = 'block';
            
            updateCostSummary();
        }

        function calculateOverheadCosts() {
            const method = document.getElementById('overhead-method').value;
            const value = parseFloat(document.getElementById('overhead-value').value);
            const storageCost = parseFloat(document.getElementById('storage-cost').value);
            const batchSize = parseFloat(document.getElementById('batch-size').value);

            let overheadPerUnit = 0;

            if (method === 'percentage') {
                const directCosts = costAnalysis.materialsCost + costAnalysis.packagingCost + 
                                  (costAnalysis.manufacturingCost * batchSize) + 
                                  (costAnalysis.qualityCost * batchSize);
                overheadPerUnit = (directCosts * (value / 100)) / batchSize;
            } else if (method === 'per-unit') {
                overheadPerUnit = value;
            } else if (method === 'per-batch') {
                overheadPerUnit = value / batchSize;
            }

            overheadPerUnit += storageCost;
            costAnalysis.overheadCost = overheadPerUnit;
            
            const resultDiv = document.getElementById('overhead-result');
            resultDiv.textContent = `Overhead Cost per Unit: $${overheadPerUnit.toFixed(3)}`;
            resultDiv.style.display = 'block';
            
            updateCostSummary();
        }

        function calculateProfitability() {
            const retailPrice = parseFloat(document.getElementById('retail-price').value);
            const retailerMargin = parseFloat(document.getElementById('retailer-margin').value) / 100;
            const distributorMargin = parseFloat(document.getElementById('distributor-margin').value) / 100;
            const batchSize = parseFloat(document.getElementById('batch-size').value);

            if (!retailPrice) {
                alert('Please enter a retail price');
                return;
            }

            const wholesalePrice = retailPrice * (1 - retailerMargin);
            const manufacturerPrice = wholesalePrice * (1 - distributorMargin);
            
            const materialCostPerUnit = costAnalysis.materialsCost / batchSize;
            const packagingCostPerUnit = costAnalysis.packagingCost / batchSize;
            
            const totalCOGS = materialCostPerUnit + packagingCostPerUnit + 
                            costAnalysis.manufacturingCost + costAnalysis.qualityCost + 
                            costAnalysis.overheadCost;
            
            const netProfit = manufacturerPrice - totalCOGS;
            const grossMargin = totalCOGS > 0 ? ((manufacturerPrice - totalCOGS) / manufacturerPrice * 100) : 0;

            costAnalysis.profitAnalysis = {
                retailPrice,
                wholesalePrice,
                manufacturerPrice,
                totalCOGS,
                netProfit,
                grossMargin
            };
            
            const resultDiv = document.getElementById('profit-result');
            resultDiv.innerHTML = `
                <strong>Profitability Analysis:</strong><br>
                Retail Price: $${retailPrice.toFixed(2)}<br>
                Wholesale Price: $${wholesalePrice.toFixed(2)}<br>
                Manufacturer Price: $${manufacturerPrice.toFixed(2)}<br>
                Total COGS: $${totalCOGS.toFixed(2)}<br>
                Net Profit: $${netProfit.toFixed(2)}<br>
                Gross Margin: ${grossMargin.toFixed(1)}%
            `;
            resultDiv.style.display = 'block';
            
            updateCostSummary();
        }

        function updateCostSummary() {
            const batchSize = parseFloat(document.getElementById('batch-size').value);
            
            const materialCostPerUnit = materials.length > 0 ? costAnalysis.materialsCost / batchSize : 0;
            const packagingCostPerUnit = packaging.length > 0 ? costAnalysis.packagingCost / batchSize : 0;
            
            costAnalysis.totalCOGS = materialCostPerUnit + packagingCostPerUnit + 
                                    costAnalysis.manufacturingCost + costAnalysis.qualityCost + 
                                    costAnalysis.overheadCost;

            document.getElementById('total-cogs').textContent = `$${costAnalysis.totalCOGS.toFixed(2)}`;

            if (costAnalysis.profitAnalysis) {
                document.getElementById('gross-margin').textContent = `${costAnalysis.profitAnalysis.grossMargin.toFixed(1)}%`;
                document.getElementById('net-profit').textContent = `$${costAnalysis.profitAnalysis.netProfit.toFixed(2)}`;
            }
        }

        function calculateAllCosts() {
            let summary = '✅ Cost Calculation Complete!\n\n';
            const batchSize = parseFloat(document.getElementById('batch-size').value);

            if (materials.length > 0) {
                calculateMaterialCosts();
                summary += `Materials: $${costAnalysis.materialsCost.toFixed(2)}\n`;
            } else {
                summary += 'Materials: Not added\n';
            }

            if (packaging.length > 0) {
                calculatePackagingCosts();
                summary += `Packaging: $${costAnalysis.packagingCost.toFixed(2)}\n`;
            } else {
                summary += 'Packaging: Not added\n';
            }

            calculateManufacturingCosts();
            summary += `Manufacturing: $${costAnalysis.manufacturingCost.toFixed(3)}/unit\n`;

            calculateQualityCosts();
            summary += `Quality Control: $${costAnalysis.qualityCost.toFixed(3)}/unit\n`;

            calculateOverheadCosts();
            summary += `Overhead: $${costAnalysis.overheadCost.toFixed(3)}/unit\n`;

            const retailPrice = parseFloat(document.getElementById('retail-price').value);
            if (retailPrice) {
                calculateProfitability();
                summary += `\nNet Profit: $${costAnalysis.profitAnalysis.netProfit.toFixed(2)}\n`;
                summary += `Gross Margin: ${costAnalysis.profitAnalysis.grossMargin.toFixed(1)}%\n`;
            } else {
                summary += '\nProfit Analysis: Enter retail price to calculate\n';
            }

            summary += `\nTotal COGS per Unit: $${costAnalysis.totalCOGS.toFixed(2)}`;

            alert(summary);
            updateCostSummary();
        }

        function generateReport() {
            const batchSize = parseFloat(document.getElementById('batch-size').value);
            
            let report = '=== COMPREHENSIVE COST ANALYSIS REPORT ===\n\n';
            report += `Batch Size: ${batchSize} units\n\n`;

            report += '--- RAW MATERIALS ---\n';
            materials.forEach(m => {
                report += `${m.name}: ${m.quantity} ${m.unit} @ $${m.unitCost.toFixed(4)} = $${m.totalCost.toFixed(2)}\n`;
            });
            report += `Total Materials: $${costAnalysis.materialsCost.toFixed(2)}\n`;
            report += `Per Unit: $${(costAnalysis.materialsCost / batchSize).toFixed(4)}\n\n`;

            report += '--- PACKAGING ---\n';
            packaging.forEach(p => {
                report += `${p.name}: ${p.quantity} ${p.unit} @ $${p.unitCost.toFixed(4)} = $${p.totalCost.toFixed(2)}\n`;
            });
            report += `Total Packaging: $${costAnalysis.packagingCost.toFixed(2)}\n`;
            report += `Per Unit: $${(costAnalysis.packagingCost / batchSize).toFixed(4)}\n\n`;

            report += '--- MANUFACTURING & OVERHEAD ---\n';
            report += `Manufacturing per Unit: $${costAnalysis.manufacturingCost.toFixed(3)}\n`;
            report += `Quality Control per Unit: $${costAnalysis.qualityCost.toFixed(3)}\n`;
            report += `Overhead per Unit: $${costAnalysis.overheadCost.toFixed(3)}\n\n`;

            report += '--- TOTAL COSTS ---\n';
            report += `Total COGS per Unit: $${costAnalysis.totalCOGS.toFixed(2)}\n`;
            report += `Total COGS per Batch: $${(costAnalysis.totalCOGS * batchSize).toFixed(2)}\n\n`;

            if (costAnalysis.profitAnalysis) {
                report += '--- PROFITABILITY ANALYSIS ---\n';
                report += `Retail Price: $${costAnalysis.profitAnalysis.retailPrice.toFixed(2)}\n`;
                report += `Wholesale Price: $${costAnalysis.profitAnalysis.wholesalePrice.toFixed(2)}\n`;
                report += `Manufacturer Price: $${costAnalysis.profitAnalysis.manufacturerPrice.toFixed(2)}\n`;
                report += `Net Profit per Unit: $${costAnalysis.profitAnalysis.netProfit.toFixed(2)}\n`;
                report += `Gross Margin: ${costAnalysis.profitAnalysis.grossMargin.toFixed(1)}%\n`;
            }

            const blob = new Blob([report], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'cost_analysis_report.txt';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function resetCalculator() {
            if (confirm('Are you sure you want to reset all data?')) {
                materials = [];
                packaging = [];
                selectedMaterialIndex = -1;
                selectedPackagingIndex = -1;
                costAnalysis = {
                    materialsCost: 0,
                    packagingCost: 0,
                    manufacturingCost: 0,
                    qualityCost: 0,
                    overheadCost: 0,
                    totalCOGS: 0,
                    profitAnalysis: null
                };

                updateMaterialsTable();
                updatePackagingTable();
                updateCostSummary();

                document.querySelectorAll('.result-display').forEach(div => {
                    div.style.display = 'none';
                });
            }
        }
    </script>
</body>
</html>
