<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Cost Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1B5E20, #2E7D32);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }

        .signature {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .subtitle {
            opacity: 0.95;
            font-size: 0.95rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            padding: 30px;
        }

        .section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .section h3 {
            color: #1B5E20;
            margin-bottom: 18px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e0e0e0;
            font-size: 1.1rem;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.95rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #1B5E20;
            box-shadow: 0 0 0 3px rgba(27, 94, 32, 0.1);
        }

        .input-group {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 12px;
        }

        .btn {
            background: linear-gradient(135deg, #1B5E20, #2E7D32);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin: 3px;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(27, 94, 32, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f44336, #ff6b6b);
        }

        .btn-success {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
        }

        .btn-primary {
            background: linear-gradient(135deg, #2196F3, #42A5F5);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .data-table th {
            background: #1B5E20;
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .data-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.85rem;
        }

        .data-table tr:hover {
            background: #f8f9fa;
            cursor: pointer;
        }

        .data-table tr.selected {
            background: #e8f5e8;
        }

        .cost-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, #e8f5e8, #f1f8f1);
            border-radius: 10px;
        }

        .summary-item {
            text-align: center;
        }

        .summary-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #1B5E20;
            margin-bottom: 5px;
        }

        .summary-label {
            font-size: 0.85rem;
            color: #666;
            text-transform: uppercase;
        }

        .result-display {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            margin: 15px 0;
            display: none;
            font-size: 0.9rem;
        }

        .result-display.error {
            background: linear-gradient(135deg, #f44336, #ff6b6b);
        }

        .quick-add {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .quick-add-header {
            font-weight: 600;
            color: #1B5E20;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .input-group {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="signature">Philip Riachy, PhD</div>
            <h1>Professional Cost Calculator</h1>
            <p class="subtitle">Comprehensive Cosmetic Formulation Cost Analysis & Profitability Tool</p>
        </div>

        <div class="main-content">
            <!-- Raw Materials Section -->
            <div class="section">
                <h3>🧪 Raw Materials</h3>
                
                <div class="quick-add">
                    <div class="quick-add-header">Quick Add Material</div>
                    <div class="input-group">
                        <input type="text" id="material-name" class="form-control" placeholder="Material Name (e.g., Hyaluronic Acid)">
                        <input type="number" id="material-quantity" class="form-control" step="0.001" min="0" placeholder="Quantity">
                        <select id="material-unit" class="form-control">
                            <option value="g">g</option>
                            <option value="kg">kg</option>
                            <option value="ml">ml</option>
                            <option value="l">l</option>
                            <option value="units">units</option>
                        </select>
                        <input type="number" id="material-cost" class="form-control" step="0.001" min="0" placeholder="$ per unit">
                    </div>
                    <button class="btn btn-success" onclick="addMaterial()">+ Add Material</button>
                    <button class="btn btn-danger" onclick="removeSelectedMaterial()">- Remove Selected</button>
                </div>

                <table class="data-table" id="materials-table">
                    <thead>
                        <tr>
                            <th>Material Name</th>
                            <th>Quantity</th>
                            <th>Unit Cost</th>
                            <th>Total Cost</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>

                <button class="btn btn-primary" onclick="calculateMaterialCosts()">Calculate Material Costs</button>
                <div id="materials-result" class="result-display"></div>
            </div>

            <!-- Packaging Section -->
            <div class="section">
                <h3>📦 Packaging</h3>
                
                <div class="quick-add">
                    <div class="quick-add-header">Quick Add Packaging</div>
                    <div class="input-group">
                        <input type="text" id="packaging-name" class="form-control" placeholder="Packaging Item (e.g., 30ml Glass Bottle)">
                        <input type="number" id="packaging-quantity" class="form-control" step="0.001" min="0" placeholder="Quantity">
                        <select id="packaging-unit" class="form-control">
                            <option value="units">units</option>
                            <option value="g">g</option>
                            <option value="kg">kg</option>
                            <option value="ml">ml</option>
                            <option value="l">l</option>
                        </select>
                        <input type="number" id="packaging-cost" class="form-control" step="0.001" min="0" placeholder="$ per unit">
                    </div>
                    <button class="btn btn-success" onclick="addPackaging()">+ Add Packaging</button>
                    <button class="btn btn-danger" onclick="removeSelectedPackaging()">- Remove Selected</button>
                </div>

                <table class="data-table" id="packaging-table">
                    <thead>
                        <tr>
                            <th>Packaging Item</th>
                            <th>Quantity</th>
                            <th>Unit Cost</th>
                            <th>Total Cost</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>

                <button class="btn btn-primary" onclick="calculatePackagingCosts()">Calculate Packaging Costs</button>
                <div id="packaging-result" class="result-display"></div>
            </div>

            <!-- Manufacturing Costs -->
            <div class="section">
                <h3>🏭 Manufacturing</h3>
                
                <div class="form-group">
                    <label>Batch Size (units)</label>
                    <input type="number" id="batch-size" class="form-control" value="1000" min="1">
                </div>

                <div class="form-group">
                    <label>Labor Cost per Batch ($)</label>
                    <input type="number" id="labor-cost" class="form-control" step="0.01" min="0" value="50">
                </div>

                <div class="form-group">
                    <label>Equipment/Utilities per Batch ($)</label>
                    <input type="number" id="equipment-cost" class="form-control" step="0.01" min="0" value="25">
                </div>

                <div class="form-group">
                    <label>Quality Control/Testing ($)</label>
                    <input type="number" id="qc-cost" class="form-control" step="0.01" min="0" value="75">
                </div>

                <button class="btn btn-primary" onclick="calculateManufacturingCosts()">Calculate Manufacturing</button>
                <div id="manufacturing-result" class="result-display"></div>
            </div>

            <!-- Profit Analysis -->
            <div class="section">
                <h3>💰 Profit Analysis</h3>
                
                <div class="form-group">
                    <label>Target Retail Price ($)</label>
                    <input type="number" id="retail-price" class="form-control" step="0.01" min="0">
                </div>

                <div class="form-group">
                    <label>Retailer Margin (%)</label>
                    <input type="number" id="retailer-margin" class="form-control" step="1" min="0" max="100" value="50">
                </div>

                <div class="form-group">
                    <label>Distributor Margin (%)</label>
                    <input type="number" id="distributor-margin" class="form-control" step="1" min="0" max="100" value="25">
                </div>

                <button class="btn btn-primary" onclick="calculateProfitability()">Calculate Profitability</button>
                <div id="profit-result" class="result-display"></div>
            </div>

            <!-- Total Cost Summary -->
            <div class="section" style="grid-column: 1 / -1;">
                <h3>📊 Total Cost Summary</h3>
                
                <div class="cost-summary" id="cost-summary">
                    <div class="summary-item">
                        <div class="summary-value" id="total-cogs">$0.00</div>
                        <div class="summary-label">Total COGS</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value" id="gross-margin">0%</div>
                        <div class="summary-label">Gross Margin</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value" id="net-profit">$0.00</div>
                        <div class="summary-label">Net Profit per Unit</div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-success" onclick="calculateAllCosts()">📊 Calculate All Costs</button>
                    <button class="btn btn-primary" onclick="generateReport()">📄 Generate PDF Report</button>
                    <button class="btn" onclick="resetCalculator()">🔄 Reset Calculator</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application State
        let materials = [];
        let packaging = [];
        let selectedMaterialIndex = -1;
        let selectedPackagingIndex = -1;
        let costAnalysis = {
            materialsCost: 0,
            packagingCost: 0,
            manufacturingCost: 0,
            totalCOGS: 0,
            profitAnalysis: null
        };

        // Material Functions
        function addMaterial() {
            const name = document.getElementById('material-name').value.trim();
            const quantity = parseFloat(document.getElementById('material-quantity').value);
            const unit = document.getElementById('material-unit').value;
            const unitCost = parseFloat(document.getElementById('material-cost').value);

            if (!name || !quantity || !unitCost) {
                alert('Please fill in all material fields');
                return;
            }

            const material = {
                name: name,
                quantity: quantity,
                unit: unit,
                unitCost: unitCost,
                totalCost: quantity * unitCost
            };

            materials.push(material);
            updateMaterialsTable();
            
            // Clear inputs
            document.getElementById('material-name').value = '';
            document.getElementById('material-quantity').value = '';
            document.getElementById('material-cost').value = '';
        }

        function updateMaterialsTable() {
            const tbody = document.querySelector('#materials-table tbody');
            tbody.innerHTML = '';

            materials.forEach((material, index) => {
                const row = document.createElement('tr');
                row.onclick = () => selectMaterialRow(index);
                row.innerHTML = `
                    <td>${material.name}</td>
                    <td>${material.quantity} ${material.unit}</td>
                    <td>$${material.unitCost.toFixed(3)}</td>
                    <td>$${material.totalCost.toFixed(2)}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function selectMaterialRow(index) {
            selectedMaterialIndex = index;
            const rows = document.querySelectorAll('#materials-table tbody tr');
            rows.forEach((row, i) => {
                row.classList.toggle('selected', i === index);
            });
        }

        function removeSelectedMaterial() {
            if (selectedMaterialIndex === -1) {
                alert('Please select a material to remove');
                return;
            }

            materials.splice(selectedMaterialIndex, 1);
            selectedMaterialIndex = -1;
            updateMaterialsTable();
        }

        // Packaging Functions
        function addPackaging() {
            const name = document.getElementById('packaging-name').value.trim();
            const quantity = parseFloat(document.getElementById('packaging-quantity').value);
            const unit = document.getElementById('packaging-unit').value;
            const unitCost = parseFloat(document.getElementById('packaging-cost').value);

            if (!name || !quantity || !unitCost) {
                alert('Please fill in all packaging fields');
                return;
            }

            const pack = {
                name: name,
                quantity: quantity,
                unit: unit,
                unitCost: unitCost,
                totalCost: quantity * unitCost
            };

            packaging.push(pack);
            updatePackagingTable();
            
            // Clear inputs
            document.getElementById('packaging-name').value = '';
            document.getElementById('packaging-quantity').value = '';
            document.getElementById('packaging-cost').value = '';
        }

        function updatePackagingTable() {
            const tbody = document.querySelector('#packaging-table tbody');
            tbody.innerHTML = '';

            packaging.forEach((pack, index) => {
                const row = document.createElement('tr');
                row.onclick = () => selectPackagingRow(index);
                row.innerHTML = `
                    <td>${pack.name}</td>
                    <td>${pack.quantity} ${pack.unit}</td>
                    <td>$${pack.unitCost.toFixed(3)}</td>
                    <td>$${pack.totalCost.toFixed(2)}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function selectPackagingRow(index) {
            selectedPackagingIndex = index;
            const rows = document.querySelectorAll('#packaging-table tbody tr');
            rows.forEach((row, i) => {
                row.classList.toggle('selected', i === index);
            });
        }

        function removeSelectedPackaging() {
            if (selectedPackagingIndex === -1) {
                alert('Please select a packaging item to remove');
                return;
            }

            packaging.splice(selectedPackagingIndex, 1);
            selectedPackagingIndex = -1;
            updatePackagingTable();
        }

        // Cost Calculation Functions
        function calculateMaterialCosts() {
            if (materials.length === 0) {
                alert('Please add materials first');
                return;
            }

            costAnalysis.materialsCost = materials.reduce((sum, m) => sum + m.totalCost, 0);
            
            const resultDiv = document.getElementById('materials-result');
            resultDiv.textContent = `Total Materials Cost: $${costAnalysis.materialsCost.toFixed(2)}`;
            resultDiv.style.display = 'block';
            
            updateCostSummary();
        }

        function calculatePackagingCosts() {
            if (packaging.length === 0) {
                alert('Please add packaging items first');
                return;
            }

            costAnalysis.packagingCost = packaging.reduce((sum, p) => sum + p.totalCost, 0);
            
            const resultDiv = document.getElementById('packaging-result');
            resultDiv.textContent = `Total Packaging Cost: $${costAnalysis.packagingCost.toFixed(2)}`;
            resultDiv.style.display = 'block';
            
            updateCostSummary();
        }

        function calculateManufacturingCosts() {
            const batchSize = parseFloat(document.getElementById('batch-size').value);
            const laborCost = parseFloat(document.getElementById('labor-cost').value);
            const equipmentCost = parseFloat(document.getElementById('equipment-cost').value);
            const qcCost = parseFloat(document.getElementById('qc-cost').value);

            const totalBatchCost = laborCost + equipmentCost + qcCost;
            const perUnitCost = totalBatchCost / batchSize;

            costAnalysis.manufacturingCost = perUnitCost;
            
            const resultDiv = document.getElementById('manufacturing-result');
            resultDiv.textContent = `Manufacturing Cost per Unit: $${perUnitCost.toFixed(3)} (Total Batch: $${totalBatchCost.toFixed(2)})`;
            resultDiv.style.display = 'block';
            
            updateCostSummary();
        }

        function calculateProfitability() {
            const retailPrice = parseFloat(document.getElementById('retail-price').value);
            const retailerMargin = parseFloat(document.getElementById('retailer-margin').value) / 100;
            const distributorMargin = parseFloat(document.getElementById('distributor-margin').value) / 100;

            if (!retailPrice) {
                alert('Please enter a retail price');
                return;
            }

            const wholesalePrice = retailPrice * (1 - retailerMargin);
            const manufacturerPrice = wholesalePrice * (1 - distributorMargin);
            const totalCOGS = costAnalysis.materialsCost + costAnalysis.packagingCost + costAnalysis.manufacturingCost;
            const netProfit = manufacturerPrice - totalCOGS;
            const grossMargin = totalCOGS > 0 ? ((manufacturerPrice - totalCOGS) / manufacturerPrice * 100) : 0;

            costAnalysis.profitAnalysis = {
                retailPrice,
                wholesalePrice,
                manufacturerPrice,
                netProfit,
                grossMargin
            };
            
            const resultDiv = document.getElementById('profit-result');
            resultDiv.textContent = `Wholesale: $${wholesalePrice.toFixed(2)} | Your Price: $${manufacturerPrice.toFixed(2)} | Profit: $${netProfit.toFixed(2)}`;
            resultDiv.style.display = 'block';
            
            updateCostSummary();
        }

        function calculateAllCosts() {
            calculateMaterialCosts();
            calculatePackagingCosts();
            calculateManufacturingCosts();
            calculateProfitability();
        }

        function updateCostSummary() {
            costAnalysis.totalCOGS = costAnalysis.materialsCost + costAnalysis.packagingCost + costAnalysis.manufacturingCost;
            
            document.getElementById('total-cogs').textContent = `$${costAnalysis.totalCOGS.toFixed(2)}`;
            
            if (costAnalysis.profitAnalysis) {
                document.getElementById('gross-margin').textContent = `${costAnalysis.profitAnalysis.grossMargin.toFixed(1)}%`;
                document.getElementById('net-profit').textContent = `$${costAnalysis.profitAnalysis.netProfit.toFixed(2)}`;
            }
        }

        function generateReport() {
            if (typeof window.jspdf === 'undefined') {
                alert('PDF library not loaded. Please refresh the page.');
                return;
            }

            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();

            let y = 20;

            // Header
            pdf.setFontSize(16);
            pdf.setFont(undefined, 'bold');
            pdf.text('Cost Analysis Report', 20, y);
            y += 15;

            pdf.setFontSize(10);
            pdf.setFont(undefined, 'normal');
            pdf.text(`Date: ${new Date().toLocaleDateString()}`, 20, y);
            y += 15;

            // Materials
            if (materials.length > 0) {
                pdf.setFontSize(12);
                pdf.setFont(undefined, 'bold');
                pdf.text('Raw Materials', 20, y);
                y += 8;

                pdf.setFontSize(9);
                pdf.setFont(undefined, 'normal');
                materials.forEach(m => {
                    pdf.text(`${m.name}: ${m.quantity}${m.unit} @ $${m.unitCost.toFixed(3)} = $${m.totalCost.toFixed(2)}`, 25, y);
                    y += 6;
                });
                pdf.setFont(undefined, 'bold');
                pdf.text(`Total: $${costAnalysis.materialsCost.toFixed(2)}`, 25, y);
                y += 12;
            }

            // Packaging
            if (packaging.length > 0) {
                pdf.setFontSize(12);
                pdf.setFont(undefined, 'bold');
                pdf.text('Packaging', 20, y);
                y += 8;

                pdf.setFontSize(9);
                pdf.setFont(undefined, 'normal');
                packaging.forEach(p => {
                    pdf.text(`${p.name}: ${p.quantity}${p.unit} @ $${p.unitCost.toFixed(3)} = $${p.totalCost.toFixed(2)}`, 25, y);
                    y += 6;
                });
                pdf.setFont(undefined, 'bold');
                pdf.text(`Total: $${costAnalysis.packagingCost.toFixed(2)}`, 25, y);
                y += 12;
            }

            // Summary
            pdf.setFontSize(12);
            pdf.setFont(undefined, 'bold');
            pdf.text('Cost Summary', 20, y);
            y += 8;

            pdf.setFontSize(10);
            pdf.setFont(undefined, 'normal');
            pdf.text(`Total COGS: $${costAnalysis.totalCOGS.toFixed(2)}`, 25, y);
            y += 6;

            if (costAnalysis.profitAnalysis) {
                pdf.text(`Gross Margin: ${costAnalysis.profitAnalysis.grossMargin.toFixed(1)}%`, 25, y);
                y += 6;
                pdf.text(`Net Profit: $${costAnalysis.profitAnalysis.netProfit.toFixed(2)}`, 25, y);
            }

            pdf.save('cost-analysis-report.pdf');
        }

        function resetCalculator() {
            if (confirm('Are you sure you want to reset all data?')) {
                materials = [];
                packaging = [];
                selectedMaterialIndex = -1;
                selectedPackagingIndex = -1;
                costAnalysis = {
                    materialsCost: 0,
                    packagingCost: 0,
                    manufacturingCost: 0,
                    totalCOGS: 0,
                    profitAnalysis: null
                };

                updateMaterialsTable();
                updatePackagingTable();
                updateCostSummary();

                document.getElementById('materials-result').style.display = 'none';
                document.getElementById('packaging-result').style.display = 'none';
                document.getElementById('manufacturing-result').style.display = 'none';
                document.getElementById('profit-result').style.display = 'none';
            }
        }
    </script>
</body>
</html>
